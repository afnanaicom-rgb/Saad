<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afnan AI - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Arabic:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans Arabic', sans-serif;
            background-color: #000000;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: white;
            overflow: hidden;
        }
        .auth-btn {
            height: 48px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            font-size: 14px;
        }
        .btn-github { background-color: #24292e; }
        .btn-x { background-color: #000000; border: 1px solid #333; }
        
        .lang-trigger {
            position: absolute;
            top: 20px;
            left: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            transition: 0.3s;
            z-index: 50;
        }
        .lang-trigger:hover { background: rgba(255, 255, 255, 0.15); }

        #langModal {
            display: none;
            position: absolute;
            top: 60px;
            left: 20px;
            background: #111;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 8px;
            width: 100px;
            z-index: 100;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .top-logo {
            position: absolute;
            top: 15px;
            right: 20px;
            width: 45px;
            height: auto;
        }

        [dir="ltr"] .top-logo { right: auto; left: 20px; }
        [dir="ltr"] .lang-trigger { left: auto; right: 20px; }
        [dir="ltr"] #langModal { left: auto; right: 20px; }
        
        #loadingOverlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <p class="mt-4 text-sm text-gray-400">جاري تسجيل الدخول...</p>
    </div>

    <a href="index.html"><img src="https://i.postimg.cc/26TTPbxH/grok-image-x6em5fj-edit-96291120058942.png" alt="Afnan AI Logo" class="top-logo"></a>

    <div class="lang-trigger" onclick="toggleModal()" id="langDisplay">EN</div>

    <div id="langModal">
        <div class="hover:bg-zinc-800 p-2 rounded cursor-pointer text-center text-sm" onclick="setLanguage('ar')">العربية</div>
        <div class="hover:bg-zinc-800 p-2 rounded cursor-pointer text-center text-sm mt-1" onclick="setLanguage('en')">English</div>
    </div>

    <div class="flex-1 flex flex-col items-center justify-center text-center px-6">
        <h1 id="title" class="text-2xl font-semibold mb-2 tracking-normal">Welcome to Afnan AI</h1>
        <p id="subtitle" class="text-gray-400 text-sm">ابدأ رحلتك الإبداعية الآن</p>
    </div>

    <div class="pb-16 px-8">
        <p id="loginPrompt" class="text-center text-gray-500 mb-6 text-xs uppercase tracking-widest">Login to Google</p>
        
        <div class="flex flex-col gap-3">
            <button id="googleLoginBtn" class="auth-btn w-full bg-white text-black font-bold rounded-xl flex items-center justify-center gap-3 transition-all hover:bg-gray-100 active:scale-95">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" class="w-4 h-4">
                <span id="googleBtn">Google Log in</span>
            </button>

            <button id="githubLoginBtn" class="auth-btn w-full btn-github text-white font-semibold rounded-xl flex items-center justify-center transition-all hover:opacity-90 active:scale-95">
                <span id="githubBtn">GitHub Login</span>
            </button>

            <button class="auth-btn w-full btn-x text-white font-semibold rounded-xl flex items-center justify-center transition-all hover:bg-zinc-900 active:scale-95">
                <span id="xBtn">Login with X</span>
            </button>
        </div>
    </div>

    <script type="module">
        import { auth, googleProvider, githubProvider } from "./firebase-config.js";
        import { signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // التحقق من حالة تسجيل الدخول فور تحميل الصفحة
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User already logged in, redirecting...");
                saveUserAndRedirect(user);
            }
        });

        function saveUserAndRedirect(user) {
            localStorage.setItem('afnan_user', JSON.stringify({
                uid: user.uid,
                displayName: user.displayName,
                email: user.email,
                photoURL: user.photoURL
            }));
            // التحويل في نفس التبويب فوراً
            window.location.replace('afnan.html');
        }

        // تسجيل الدخول عبر جوجل بنظام الـ Popup
        document.getElementById('googleLoginBtn').onclick = () => {
            document.getElementById('loadingOverlay').style.display = 'flex';
            signInWithPopup(auth, googleProvider)
                .then((result) => {
                    if (result.user) {
                        saveUserAndRedirect(result.user);
                    }
                })
                .catch((error) => {
                    console.error("Popup Error:", error);
                    document.getElementById('loadingOverlay').style.display = 'none';
                    if (error.code !== 'auth/popup-closed-by-user') {
                        alert("حدث خطأ أثناء تسجيل الدخول: " + error.message);
                    }
                });
        };

        // تسجيل الدخول عبر GitHub بنظام الـ Popup
        document.getElementById('githubLoginBtn').onclick = () => {
            document.getElementById('loadingOverlay').style.display = 'flex';
            signInWithPopup(auth, githubProvider)
                .then((result) => {
                    if (result.user) {
                        saveUserAndRedirect(result.user);
                    }
                })
                .catch((error) => {
                    console.error("Popup Error:", error);
                    document.getElementById('loadingOverlay').style.display = 'none';
                    if (error.code !== 'auth/popup-closed-by-user') {
                        alert("حدث خطأ أثناء تسجيل الدخول: " + error.message);
                    }
                });
        };
    </script>

    <script>
        let currentLang = 'ar';

        const translations = {
            ar: {
                title: "Welcome to Afnan AI",
                subtitle: "ابدأ رحلتك الإبداعية الآن",
                loginPrompt: "تسجيل الدخول عبر جوجل",
                google: "Google Log in",
                github: "GitHub Login",
                x: "Login with X",
                display: "EN",
                dir: "rtl"
            },
            en: {
                title: "Welcome to Afnan AI",
                subtitle: "Start your creative journey now",
                loginPrompt: "Login to Google",
                google: "Google Log in",
                github: "GitHub Login",
                x: "Login with X",
                display: "عربي",
                dir: "ltr"
            }
        };

        function toggleModal() {
            const modal = document.getElementById('langModal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        function setLanguage(lang) {
            currentLang = lang;
            const html = document.getElementById('mainHtml');
            const data = translations[lang];

            html.dir = data.dir;
            html.lang = lang;

            document.getElementById('title').innerText = data.title;
            document.getElementById('subtitle').innerText = data.subtitle;
            document.getElementById('loginPrompt').innerText = data.loginPrompt;
            document.getElementById('googleBtn').innerText = data.google;
            document.getElementById('githubBtn').innerText = data.github;
            document.getElementById('xBtn').innerText = data.x;
            document.getElementById('langDisplay').innerText = data.display;

            document.getElementById('langModal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (!event.target.matches('.lang-trigger')) {
                document.getElementById('langModal').style.display = 'none';
            }
        }
    </script>
</body>
</html>
